<div class="space-y-8">
    <div class="flex items-center justify-between">
        <h2 class="text-3xl font-bold text-gray-800">Add New Task</h2>
        <a href="#" data-page="Tasks" class="text-sm font-medium text-indigo-600 hover:text-indigo-800">
            &larr; Back to Task Board
        </a>
    </div>

    <div class="bg-white p-8 rounded-xl shadow-lg">
        <form class="space-y-8">
            <div>
                <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Task Details</h3>
                <div class="space-y-4">
                    <div>
                        <label for="taskTitle" class="block text-sm font-medium text-gray-600">Task Title</label>
                        <input type="text" id="taskTitle" placeholder="e.g., Follow up on Claim #12345" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="taskDescription" class="block text-sm font-medium text-gray-600">Description (Optional)</label>
                        <textarea id="taskDescription" rows="3" placeholder="Add any relevant notes or details here..." class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>
                </div>
            </div>

            <div>
                 <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Assignment & Scheduling</h3>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="assignToClient" class="block text-sm font-medium text-gray-600">Assign to Client</label>
                        <select id="assignToClient" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option>Dental Care Inc.</option>
                            <option>Bright Smiles LLC</option>
                            <option>Ortho Solutions</option>
                        </select>
                    </div>
                     <div>
                        <label for="assignToEmployee" class="block text-sm font-medium text-gray-600">Assign to Employee</label>
                        <select id="assignToEmployee" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option>John Doe</option>
                            <option>Jane Smith</option>
                            <option>Michael Chen</option>
                            <option>Maria Garcia</option>
                        </select>
                    </div>
                    <div>
                        <label for="dueDate" class="block text-sm font-medium text-gray-600">Due Date</label>
                        <input type="date" id="dueDate" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="priority" class="block text-sm font-medium text-gray-600">Priority</label>
                         <select id="priority" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option>Medium</option>
                            <option>High</option>
                            <option>Low</option>
                        </select>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Time & Billing</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="estimatedHours" class="block text-sm font-medium text-gray-600">Estimated Hours</label>
                        <input type="number" id="estimatedHours" placeholder="e.g., 5.5" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="paymentAmount" class="block text-sm font-medium text-gray-600">Payment Amount (USD)</label>
                        <input type="number" id="paymentAmount" placeholder="e.g., 250" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </div>

            <div class="flex justify-end space-x-4 pt-6 border-t">
                <button type="button" data-page="Tasks" class="px-6 py-2 bg-gray-100 text-gray-700 font-semibold rounded-lg hover:bg-gray-200">Cancel</button>
                <button type="submit" class="px-6 py-2 bg-[#F46425] text-white font-semibold rounded-lg shadow-md hover:bg-opacity-90">Save Task</button>
            </div>
        </form>
    </div>
</div>

<script>
    (function() {
        // --- Form Submission Logic ---
        const form = document.querySelector('form');
        if (!form) return;

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                type: 'Other', // You can add a type field to the form
                priority: document.getElementById('priority').value.toLowerCase(),
                assignedToEmployee: null, // This should be linked to actual employee IDs
                clientName: document.getElementById('assignToClient').value,
                dueDate: document.getElementById('dueDate').value,
                revenue: document.getElementById('paymentAmount').value || 0,
                estimatedHours: document.getElementById('estimatedHours').value || 0
            };

            try {
                // Try to use API first
                const response = await fetch('http://localhost:5000/api/tasks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(taskData),
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert('Task created successfully!');
                    document.querySelector(`a[data-page='Tasks']`).click();
                    return;
                } else {
                    throw new Error('API not available');
                }
            } catch (error) {
                console.warn('API not available, using localStorage:', error);
                
                // Fallback to localStorage
                const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
                const newTask = {
                    id: Date.now().toString(),
                    ...taskData,
                    taskNumber: `GDB-T${String(tasks.length + 1).padStart(3, '0')}`,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                tasks.push(newTask);
                localStorage.setItem('tasks', JSON.stringify(tasks));
                
                alert('Task created successfully (saved locally)!');
                document.querySelector(`a[data-page='Tasks']`).click();
            }
        });

        // --- Cancel Button Logic ---
        document.querySelector('button[data-page="Tasks"]').addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector(`a[data-page='Tasks']`).click();
        });
    })();
</script>